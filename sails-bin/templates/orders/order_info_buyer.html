{% extends "base.html" %}
{% block title %}Order Details{% endblock title %}
{% block content %}
<main class="container">
    <div class="bg-light p-5 rounded">
      <h1>Details of your order #{{ order.get_shortid() }}</h1>
      <br>
      {% match order.get_transaction_status() %}
      {% when sails_db::enums::TransactionStatus::Refunded %}
      <div class="progress">
	<div class="progress-bar bg-secondary" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
      </div>
      <br>
      <h3>Order refunded (canceled)</h3>
      There is nothing left to do.

      {% when sails_db::enums::TransactionStatus::Placed %}
      <div class="progress">
	<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%"></div>
      </div>
      <br>
      <h3>Order successfully placed</h3>
      Scan the QR code or click the button to pay to proceed, then you should await the seller to confirm the payment.<br>
      <br>
      <div id="qrcode"></div><br>
      <a href="alipays://platformapi/startapp?appId=20000067&url=https%3A%2F%2Fflibrary.info%2Forders%2Falipay%3Forder_id%3D{{order.get_id()}}" class="btn btn-primary" role="button">Pay via AliPay</a><br>

      {% when sails_db::enums::TransactionStatus::Paid %}
      <div class="progress">
	<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100" style="width: 66%"></div>
      </div>
      <br>
      <h3>Order successfully paid</h3>
      The last step to complete this order is to come to the warehouse to get your book! Do remember to bring the order ID: <code>{{ order.get_shortid() }}</code>.

      {% when sails_db::enums::TransactionStatus::Finished %}
      <div class="progress">
	<div class="progress-bar bg-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
      </div>
      <br>
      <h3>Congratulations, order has been successfully finished!</h2>
      There is nothing left to do. Enjoy your book!
      {% endmatch %}
    </div>
<br>
<div class="bg-light p-5 rounded">
      <table class="table table-hover">
    <tbody>
    <tr>
      <th scope="row">Price</th>
      <td>CNÂ¥ {{ book.get_price() }}</td>
    </tr>
    <tr>
      <th scope="row">Seller</th>
      <td>{{ book.get_seller_id() }}</td>
    </tr>
    <tr>
      <th scope="row">Book ID</th>
      <td>{{ book.get_shortid() }}</td>
    </tr>
    <tr>
      <th scope="row">Buyer</th>
      <td>{{ order.get_buyer() }}</td>
    </tr>
    <tr>
      <th scope="row">Timestamp</th>
      <td>{{ order.get_time_sent() }}</td>
    </tr>
    <tr>
      <th scope="row">Status</th>
      <td>{{ "{:?}"|format(order.get_transaction_status()) }}</td>
    </tr>
    </tbody>
    </table>
  </div>
</main>
{% endblock content %}

{% block script %}
  {% call super()%}
  <script type="text/javascript">
    var qrcode = new QRCode("qrcode");
    qrcode.makeCode("alipays://platformapi/startapp?appId=20000067&url=https%3A%2F%2Fflibrary.info%2Forders%2Falipay%3Forder_id%3D{{order.get_id()}}");
  </script>
{% endblock script %}
